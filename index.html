<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jadwal Pelajaran & Tugas</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap');

        :root {
            --biru-cerah: #3498db;
            --kuning-cerah: #f1c40f;
            --merah-cerah: #e74c3c;
            --putih: #ffffff;
            --hitam: #2c3e50;
            --latar-belakang: #ecf0f1;
            --teks: #34495e;
            --teks-abu: #7f8c8d;
            --transisi-cepat: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--latar-belakang);
            color: var(--teks);
        }

        .container-wrapper {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            padding: 20px;
        }

        .schedule-container {
            width: 100%;
            max-width: 800px;
            background-color: var(--putih);
            border-radius: 20px;
            box-shadow: 0 8px 30px rgba(52, 73, 94, 0.15);
            overflow: hidden;
        }

        header { background-color: var(--biru-cerah); padding: 25px; text-align: center; }
        header h1 { font-size: 2.5rem; color: var(--putih); font-weight: 800; }
        
        .controls { padding: 20px; border-bottom: 1px solid #e0e0e0; }
        .class-info-container { display: flex; flex-direction: column; align-items: center; gap: 20px; margin-bottom: 20px; opacity: 0; animation: slideDownFadeIn 0.8s ease-out 0.3s forwards; }
        .wali-kelas-card { display: flex; align-items: center; gap: 20px; background-color: #f8f9fa; padding: 15px; border-radius: 15px; border: 1px solid #e0e0e0; }
        .wali-kelas-card img { width: 80px; height: 80px; border-radius: 50%; border: 3px solid var(--biru-cerah); }
        .wali-kelas-details .wali-kelas-name { font-size: 1.5rem; font-weight: 800; color: var(--teks); }
        .wali-kelas-details .wali-kelas-title { font-size: 1rem; color: var(--teks-abu); }
        .class-photo { width: 100%; max-width: 500px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .day-filter { display: flex; justify-content: center; flex-wrap: wrap; }
        .day-btn { background-color: var(--putih); border: 2px solid var(--biru-cerah); color: var(--biru-cerah); padding: 10px 20px; margin: 5px; border-radius: 50px; cursor: pointer; font-size: 1rem; font-weight: 700; transition: var(--transisi-cepat); }
        .day-btn:hover { background-color: var(--kuning-cerah); color: var(--teks); border-color: var(--kuning-cerah); transform: translateY(-3px); }
        .day-btn.active { background-color: var(--biru-cerah); color: var(--putih); box-shadow: 0 4px 10px rgba(52, 152, 219, 0.4); }
        .info-display { text-align: center; padding: 15px 10px 5px 10px; font-size: 1.1rem; color: var(--teks); font-weight: 700; }
        .info-display strong { color: var(--biru-cerah); }

        .schedule-content { padding: 25px; }
        .schedule-day { display: none; }
        .schedule-day.active { display: grid; gap: 15px; animation: slideUp 0.5s ease-out; }
        
        .subject-card { background-color: #f8f9fa; padding: 20px; border-radius: 10px; border-left: 5px solid var(--kuning-cerah); will-change: transform; display: grid; grid-template-rows: auto 0fr; transition: grid-template-rows 0.4s ease-out; }
        .subject-card.active { grid-template-rows: auto 1fr; }
        .subject-card:hover { transform: scale(1.02); box-shadow: 0 5px 15px rgba(0,0,0,0.08); }

        .subject-details { cursor: pointer; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px; }
        .subject-details .subject-name { font-size: 1.2rem; font-weight: 700; }
        .subject-details .subject-time { font-size: 1rem; background-color: var(--biru-cerah); padding: 5px 15px; border-radius: 20px; color: var(--putih); flex-shrink: 0; }
        
        .card-extra-content { overflow: hidden; opacity: 0; transition: opacity 0.3s ease-out 0.1s; }
        .subject-card.active .card-extra-content { opacity: 1; padding-top: 15px; }

        .teacher-info { display: flex; align-items: center; gap: 15px; padding-bottom: 15px; border-bottom: 1px solid #e0e0e0; }
        .teacher-info img { width: 50px; height: 50px; border-radius: 50%; object-fit: cover; background-color: var(--latar-belakang); }
        .teacher-info .teacher-name { font-size: 1.1rem; font-weight: 700; }

        .subject-task-area { margin-top: 15px; background-color: #fdfdfd; border-radius: 8px; padding: 15px; }
        .subject-task-area h3 { margin-bottom: 15px; font-size: 1.2rem; text-align: center; }
        .task-list-inner { list-style: none; padding: 0; margin-bottom: 15px; }
        .task-item-inner { background-color: #fff; padding: 12px; border-radius: 8px; margin-bottom: 10px; border: 1px solid #eee; overflow: hidden; }
        .task-header { display: flex; justify-content: space-between; align-items: center; cursor: pointer; }
        .task-title { font-weight: 600; color: var(--biru-cerah); flex-grow: 1; }
        .task-duedate { font-size: 0.8rem; font-weight: 600; color: var(--teks-abu); margin-top: 4px; }
        
        .task-description { max-height: 0; overflow: hidden; opacity: 0; transition: all 0.4s ease-in-out; font-size: 0.9rem; color: var(--teks-abu); padding-left: 5px; border-left: 3px solid var(--latar-belakang); margin-left: 2px; }
        .task-item-inner.expanded .task-description { max-height: 100px; opacity: 1; margin-top: 8px; padding-top: 8px; border-top: 1px dashed #eee; }
        
        .add-task-form { display: flex; flex-direction: column; gap: 8px; }
        .add-task-form input, .add-task-form textarea, .add-task-form select { width: 100%; padding: 10px 12px; border-radius: 6px; border: 1px solid #ccc; font-size: 0.9rem; font-family: 'Nunito', sans-serif; transition: all 0.2s; }
        .add-task-form textarea { min-height: 50px; resize: vertical; }
        .add-task-form input:focus, .add-task-form textarea:focus, .add-task-form select:focus { outline: none; border-color: var(--biru-cerah); box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2); }
        .add-task-btn { background-color: var(--biru-cerah); color: var(--putih); border: none; padding: 10px 15px; border-radius: 6px; font-weight: 700; font-size: 1rem; cursor: pointer; transition: background-color 0.2s; }
        .add-task-btn:hover { background-color: #2980b9; }

        #global-add-task-btn {
            position: fixed;
            bottom: 25px;
            right: 25px;
            width: 60px;
            height: 60px;
            background-color: var(--biru-cerah);
            color: var(--putih);
            border: 3px solid transparent;
            border-radius: 50%;
            font-size: 1.5rem;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 1000;
            animation: rgb-glow 4s linear infinite;
        }
        @keyframes rgb-glow {
            0%   { border-color: var(--merah-cerah); } 17%  { border-color: var(--kuning-cerah); } 34%  { border-color: var(--putih); } 51%  { border-color: var(--biru-cerah); } 68%  { border-color: var(--hitam); } 85%  { border-color: var(--kuning-cerah); } 100% { border-color: var(--merah-cerah); }
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s;
        }
        .modal-content {
            background-color: #fefefe;
            margin: 10% auto;
            padding: 20px;
            border: 1px solid #888;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            position: relative;
        }
        .close-btn { color: #aaa; position: absolute; top: 10px; right: 20px; font-size: 28px; font-weight: bold; cursor: pointer; }
        .modal-content h2 { margin-bottom: 20px; text-align: center; }
        
        .modal-task-list-container { margin-top: 25px; border-top: 1px solid #eee; padding-top: 15px; }
        .modal-task-list-container h3 { font-size: 1.1rem; margin-bottom: 10px; text-align: center; color: var(--teks-abu); }
        #modal-task-list { list-style: none; padding: 0; max-height: 200px; overflow-y: auto; }
        .modal-task-item { background-color: #f9f9f9; padding: 10px; border-radius: 6px; margin-bottom: 8px; border: 1px solid #f0f0f0; display: flex; justify-content: space-between; align-items: center; gap: 10px; }
        .modal-task-item span { font-size: 0.9rem; flex-grow: 1; }
        .modal-delete-btn { background-color: var(--merah-cerah); color: var(--putih); border: none; padding: 6px 10px; border-radius: 5px; cursor: pointer; font-size: 0.8rem; font-weight: 700; transition: background-color 0.2s; }
        .modal-delete-btn:hover { background-color: #c0392b; }

        footer { text-align: center; padding: 20px; font-size: 0.9rem; color: var(--teks-abu); background-color: #f8f9fa; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideDownFadeIn { from { opacity: 0; transform: translateY(-30px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>
    <div class="container-wrapper">
        <div class="schedule-container">
            <header><h1>Jadwal X Rpl-2</h1></header>
            <div class="controls">
                <div class="class-info-container"></div>
                <div class="day-filter"></div>
                <div class="info-display" id="info-display"></div>
            </div>
            <main class="schedule-content"></main>
            <footer> &copy; 2025 Ananda </footer>
        </div>
    </div>
    <button id="global-add-task-btn" title="Tambah/Hapus Tugas">✏️</button>
    <div id="task-modal" class="modal"></div>
    
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        
        document.querySelector('.class-info-container').innerHTML = `
            <div class="wali-kelas-card">
                <img src="ibu entin.jpg" alt="Foto Wali Kelas Bu Entin">
                <div class="wali-kelas-details">
                    <div class="wali-kelas-name">Bu Entin</div>
                    <div class="wali-kelas-title">Wali Kelas</div>
                </div>
            </div>
            <img class="class-photo" src="https://placehold.co/600x300/ecf0f1/34495e?text=Foto+Kelas+X+RPL-2" alt="Foto Kelas X RPL-2">`;
        
        document.querySelector('.day-filter').innerHTML = `
            <button class="day-btn" data-day="senin">Senin</button>
            <button class="day-btn" data-day="selasa">Selasa</button>
            <button class="day-btn" data-day="rabu">Rabu</button>
            <button class="day-btn" data-day="kamis">Kamis</button>
            <button class="day-btn" data-day="jumat">Jumat</button>`;

        document.querySelector('.schedule-content').innerHTML = `
            <div id="senin" class="schedule-day">
                <div class="subject-card" data-teacher="Kurnia" data-subject="Pendidikan Pancasila"><div class="subject-details"><span class="subject-name">Pendidikan Pancasila</span><span class="subject-time">07.15 - 08.45</span></div></div>
                <div class="subject-card" data-teacher="Fajri" data-subject="Bahasa Indonesia"><div class="subject-details"><span class="subject-name">Bahasa Indonesia</span><span class="subject-time">08.45 - 09.30</span></div></div>
                <div class="subject-card" data-teacher="Ceceh" data-subject="Agama"><div class="subject-details"><span class="subject-name">Agama</span><span class="subject-time">09.45 - 12.00</span></div></div>
                <div class="subject-card" data-teacher="Batalyon" data-subject="Informatika"><div class="subject-details"><span class="subject-name">Informatika</span><span class="subject-time">12.45 - 15.00</span></div></div>
            </div>
            <div id="selasa" class="schedule-day">
                <div class="subject-card" data-teacher="Fajri" data-subject="Bahasa Indonesia"><div class="subject-details"><span class="subject-name">Bahasa Indonesia</span><span class="subject-time">06.30 - 08.45</span></div></div>
                <div class="subject-card" data-teacher="Batalyon" data-subject="Informatika"><div class="subject-details"><span class="subject-name">Informatika</span><span class="subject-time">08.45 - 09.30</span></div></div>
                <div class="subject-card" data-subject="PJOK"><div class="subject-details"><span class="subject-name">PJOK</span><span class="subject-time">09.45 - 12.00</span></div></div>
                <div class="subject-card" data-subject="BK"><div class="subject-details"><span class="subject-name">BK</span><span class="subject-time">12.45 - 13.30</span></div></div>
                <div class="subject-card" data-teacher="Kurnia" data-subject="Bahasa Inggris"><div class="subject-details"><span class="subject-name">Bahasa Inggris</span><span class="subject-time">13.30 - 15.00</span></div></div>
            </div>
            <div id="rabu" class="schedule-day">
                <div class="subject-card" data-teacher="Krisna" data-subject="Dasar-Dasar keahlian 1"><div class="subject-details"><span class="subject-name">Dasar-Dasar keahlian 1</span><span class="subject-time">06.30 - 09.30</span></div></div>
                <div class="subject-card" data-teacher="Fify" data-subject="IPAS"><div class="subject-details"><span class="subject-name">IPAS</span><span class="subject-time">09.45 - 12.00</span></div></div>
                <div class="subject-card" data-teacher="Entin" data-subject="Dasar-Dasar keahlian 2"><div class="subject-details"><span class="subject-name">Dasar-Dasar keahlian 2</span><span class="subject-time">12.45 - 15.00</span></div></div>
            </div>
            <div id="kamis" class="schedule-day">
                <div class="subject-card" data-teacher="Linda" data-subject="Seni Budaya"><div class="subject-details"><span class="subject-name">Seni Budaya</span><span class="subject-time">06.30 - 08.00</span></div></div>
                <div class="subject-card" data-teacher="Kurnia" data-subject="Bahasa Inggris"><div class="subject-details"><span class="subject-name">Bahasa Inggris</span><span class="subject-time">08.00 - 09.30</span></div></div>
                <div class="subject-card" data-teacher="Elvi" data-subject="Matematika"><div class="subject-details"><span class="subject-name">Matematika</span><span class="subject-time">09.45 - 11.15</span></div></div>
                <div class="subject-card" data-teacher="Entin" data-subject="Dasar-Dasar keahlian 2"><div class="subject-details"><span class="subject-name">Dasar-Dasar keahlian 2</span><span class="subject-time">11.15 - 12.00</span></div></div>
                <div class="subject-card" data-teacher="Entin" data-subject="Dasar-Dasar keahlian 2"><div class="subject-details"><span class="subject-name">Dasar-Dasar keahlian 2</span><span class="subject-time">12.45 - 15.00</span></div></div>
            </div>
            <div id="jumat" class="schedule-day">
                <div class="subject-card" data-teacher="Fify" data-subject="IPAS"><div class="subject-details"><span class="subject-name">IPAS</span><span class="subject-time">07.30 - 09.45</span></div></div>
                <div class="subject-card" data-teacher="Fify" data-subject="Sejarah"><div class="subject-details"><span class="subject-name">Sejarah</span><span class="subject-time">10.00 - 11.30</span></div></div>
                <div class="subject-card" data-teacher="Elvi" data-subject="Matematika"><div class="subject-details"><span class="subject-name">Matematika</span><span class="subject-time">12.45 - 14.15</span></div></div>
            </div>`;
        
        document.getElementById('task-modal').innerHTML = `
            <div class="modal-content">
                <span class="close-btn">&times;</span>
                <h2>Tambah/Hapus Tugas</h2>
                <form id="global-task-form" class="add-task-form">
                    <input type="text" id="modal-task-title" placeholder="Judul Tugas..." required>
                    <textarea id="modal-task-desc" placeholder="Deskripsi lengkap tugas..."></textarea>
                    <select id="modal-task-day" required><option value="" disabled selected>Pilih Hari...</option><option value="senin">Senin</option><option value="selasa">Selasa</option><option value="rabu">Rabu</option><option value="kamis">Kamis</option><option value="jumat">Jumat</option></select>
                    <select id="modal-task-subject" required><option value="" disabled selected>Pilih Mata Pelajaran...</option></select>
                    <input type="date" id="modal-task-duedate" required>
                    <button type="submit" class="add-task-btn">Simpan Tugas Baru</button>
                </form>
                <div class="modal-task-list-container">
                    <h3>Hapus Tugas yang Sudah Selesai</h3>
                    <ul id="modal-task-list"></ul>
                </div>
            </div>`;


        const dayButtons = document.querySelectorAll('.day-btn');
        const schedules = document.querySelectorAll('.schedule-day');
        const infoDisplay = document.getElementById('info-display');
        const allCards = document.querySelectorAll('.subject-card');
        const scheduleContent = document.querySelector('.schedule-content');
        const modal = document.getElementById('task-modal');
        const globalAddTaskBtn = document.getElementById('global-add-task-btn');
        const closeModalBtn = document.querySelector('.modal .close-btn');
        const globalTaskForm = document.getElementById('global-task-form');
        const modalTaskList = document.getElementById('modal-task-list');

        const teachersData = { 'Fajri':{name:'Bu Fajri',img:'https://placehold.co/100x100/3498db/ffffff?text=F'},'Fify':{name:'Bu Fify',img:'https://placehold.co/100x100/f1c40f/34495e?text=F'},'Ceceh':{name:'Pak Ceceh',img:'https://placehold.co/100x100/e74c3c/ffffff?text=C'},'Elvi':{name:'Bu Elvi',img:'https://placehold.co/100x100/2ecc71/ffffff?text=E'},'Kurnia':{name:'Bu Kurnia',img:'https://placehold.co/100x100/9b59b6/ffffff?text=K'},'Linda':{name:'Bu Linda',img:'https://placehold.co/100x100/e67e22/ffffff?text=L'},'Entin':{name:'Bu Entin',img:'ibu entin.jpg'},'Batalyon':{name:'Pak Sugeng',img:'https://placehold.co/100x100/c0392b/ffffff?text=S'},'Krisna':{name:'Bpk. Krisna',img:'https://placehold.co/100x100/34495e/ffffff?text=K'}};
        const greetings = { senin:"Yuk bisa yuk, baru hari pertama! 💪",selasa:"Seruu, nanti olahraga! ⚽",rabu:"Semoga ga pramuka... 🤞",kamis:"Aduh, pelajaran susah semua! 🤯",jumat:"Sama kaya Kamis, bedanya BESOK LIBUR! 🎉"};
        
        let allSubjectTasks = JSON.parse(localStorage.getItem('subjectTasks')) || {};
        const saveTasks = () => localStorage.setItem('subjectTasks', JSON.stringify(allSubjectTasks));
        
        function updateScheduleView(day) {
            dayButtons.forEach(btn => btn.classList.toggle('active', btn.dataset.day === day));
            schedules.forEach(schedule => schedule.classList.toggle('active', schedule.id === day));
            const activeSchedule = document.getElementById(day);
            if(activeSchedule) {
                const subjectCount = activeSchedule.querySelectorAll('.subject-card').length;
                infoDisplay.innerHTML = `${greetings[day]} Kamu punya <strong>${subjectCount}</strong> sesi belajar hari ini.`;
            }
        }
        
        function renderTasksForSubject(card) {
            const taskKey = card.dataset.taskKey;
            const taskListUl = card.querySelector('.task-list-inner');
            if (!taskListUl) return;

            taskListUl.innerHTML = '';
            const tasks = allSubjectTasks[taskKey] || [];
            
            if (tasks.length === 0) {
                taskListUl.innerHTML = '<li class="task-item-inner" style="border:none; padding-left:0;"><i>Belum ada tugas.</i></li>';
                return;
            }

            tasks.forEach((task, index) => {
                const li = document.createElement('li');
                li.className = 'task-item-inner';
                const dueDateHTML = task.dueDate ? `<div class="task-duedate">Kumpul: ${new Date(task.dueDate+'T00:00:00').toLocaleDateString('id-ID', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</div>` : '';
                li.innerHTML = `
                    <div class="task-header"><span class="task-title">${task.title}</span></div>
                    <div class="task-description">${task.description || '<i>Tidak ada deskripsi.</i>'}</div>
                    ${dueDateHTML}`;
                taskListUl.appendChild(li);
            });
        }

        function renderModalTaskList() {
            modalTaskList.innerHTML = '';
            const allTasksFlat = Object.entries(allSubjectTasks).flatMap(([taskKey, tasks]) => 
                tasks.map((task, index) => ({ ...task, taskKey, index }))
            );

            if (allTasksFlat.length === 0) {
                modalTaskList.innerHTML = '<li><i>Tidak ada tugas yang terdaftar.</i></li>';
                return;
            }

            allTasksFlat.forEach(taskData => {
                const [day, ...subjectParts] = taskData.taskKey.split('-');
                const subject = subjectParts.join(' ');
                const li = document.createElement('li');
                li.className = 'modal-task-item';
                li.innerHTML = `<span><b>${taskData.title}</b> (${subject}, ${day})</span>`;
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'modal-delete-btn';
                deleteBtn.textContent = '🗑️ Hapus';
                deleteBtn.dataset.taskKey = taskData.taskKey;
                deleteBtn.dataset.index = taskData.index;
                li.appendChild(deleteBtn);

                modalTaskList.appendChild(li);
            });
        }
        
        allCards.forEach(card => {
            const day = card.closest('.schedule-day').id;
            const subject = card.dataset.subject || card.querySelector('.subject-name').textContent;
            const taskKey = `${day}-${subject.replace(/\s+/g, '-')}`;
            card.dataset.taskKey = taskKey;

            const extraContent = document.createElement('div');
            extraContent.className = 'card-extra-content';
            
            const teacherKey = card.dataset.teacher;
            if (teacherKey && teachersData[teacherKey]) {
                extraContent.innerHTML += `<div class="teacher-info"><img src="${teachersData[teacherKey].img}" alt="Foto ${teachersData[teacherKey].name}"><span class="teacher-name">${teachersData[teacherKey].name}</span></div>`;
            }
            extraContent.innerHTML += `
                <div class="subject-task-area">
                    <h3>Tugas Mapel</h3>
                    <ul class="task-list-inner"></ul>
                </div>`;
            card.appendChild(extraContent);
        });

        scheduleContent.addEventListener('click', function(event) {
            const target = event.target;
            const header = target.closest('.subject-details');
            const taskTitle = target.closest('.task-title');

            if (header) {
                const cardToToggle = header.closest('.subject-card');
                const wasActive = cardToToggle.classList.contains('active');
                allCards.forEach(c => c.classList.remove('active'));
                if (!wasActive) {
                    cardToToggle.classList.add('active');
                    renderTasksForSubject(cardToToggle);
                }
                return;
            }
            if (taskTitle) {
                taskTitle.closest('.task-item-inner').classList.toggle('expanded');
            }
        });

        modalTaskList.addEventListener('click', function(event) {
            const target = event.target;
            if (target.classList.contains('modal-delete-btn')) {
                const taskKey = target.dataset.taskKey;
                const index = parseInt(target.dataset.index, 10);
                
                if (allSubjectTasks[taskKey]?.[index] !== undefined) {
                    allSubjectTasks[taskKey].splice(index, 1);
                    if (allSubjectTasks[taskKey].length === 0) {
                        delete allSubjectTasks[taskKey];
                    }
                    saveTasks();
                    renderModalTaskList();
                    const activeCard = document.querySelector(`.subject-card[data-task-key="${taskKey}"].active`);
                    if (activeCard) {
                        renderTasksForSubject(activeCard);
                    }
                }
            }
        });

        globalAddTaskBtn.addEventListener('click', () => { 
            modal.style.display = 'block';
            renderModalTaskList();
        });
        closeModalBtn.addEventListener('click', () => { modal.style.display = 'none'; });
        window.addEventListener('click', (event) => { if (event.target == modal) { modal.style.display = 'none'; } });

        globalTaskForm.addEventListener('submit', (event) => {
            event.preventDefault();
            const title = document.getElementById('modal-task-title').value.trim();
            const description = document.getElementById('modal-task-desc').value.trim();
            const day = document.getElementById('modal-task-day').value;
            const subject = document.getElementById('modal-task-subject').value;
            const dueDate = document.getElementById('modal-task-duedate').value;
            const taskKey = `${day}-${subject}`;
            const newTask = { title, description, dueDate };

            if (!allSubjectTasks[taskKey]) allSubjectTasks[taskKey] = [];
            allSubjectTasks[taskKey].push(newTask);
            saveTasks();

            const activeCard = document.querySelector(`.subject-card[data-task-key="${taskKey}"].active`);
            if (activeCard) renderTasksForSubject(activeCard);
            
            globalTaskForm.reset();
            modal.style.display = 'none';
            alert('Tugas berhasil ditambahkan!');
        });
        
        const subjectSelect = document.getElementById('modal-task-subject');
        const uniqueSubjects = [...new Set([...allCards].map(card => card.dataset.subject))];
        uniqueSubjects.forEach(subject => { if (subject) { const option = document.createElement('option'); option.value = subject.replace(/\s+/g, '-'); option.textContent = subject; subjectSelect.appendChild(option); } });
        dayButtons.forEach(button => { button.addEventListener('click', () => { allCards.forEach(c => c.classList.remove('active')); updateScheduleView(button.dataset.day); }); });

        const dayIndex = new Date().getDay();
        const daysMap = ['minggu', 'senin', 'selasa', 'rabu', 'kamis', 'jumat', 'sabtu'];
        let today = daysMap[dayIndex];
        if (today === 'sabtu' || today === 'minggu') today = 'senin';
        updateScheduleView(today);
    });
    </script>

</body>
</html>
